apiVersion: batch/v1
kind: Job
metadata:
  name: mqtt-broker-pull
spec:
  # Add backoff limit to prevent infinite retries
  backoffLimit: 3
  # Set active deadline to prevent hanging jobs
  activeDeadlineSeconds: 600
  template:
    spec:
      hostNetwork: true
      nodeSelector:
        kubernetes.io/hostname: xip
      restartPolicy: Never
      containers:
      - name: mqtt-broker-pull
        image: eclipse-mosquitto:2.0.14
        imagePullPolicy: Always
        command: ["true"]
        # Add resource limits to prevent resource issues
        resources:
          requests:
            memory: "64Mi"
            cpu: "50m"
          limits:
            memory: "128Mi"
            cpu: "100m"
